import pandas as pd
import numpy as np
import cx_Oracle
from sqlalchemy import create_engine
from sqlalchemy import *
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import session, sessionmaker
from sqlalchemy.sql.expression import select,insert
cx_Oracle.init_oracle_client(lib_dir=r"C:\oracle\instantclient_11_2")


SQL_ALCHEMY_DATABASE_URL = 'oracle://DATOSDECAMPO:paseos@192.168.3.70:1521/sci'
SQL_ALCHEMY_MONITOREO_URL = 'oracle://MONITOREOM:mon2007@192.168.3.70:1521/sci'

engine = create_engine(SQL_ALCHEMY_DATABASE_URL)
monitoreo = create_engine(SQL_ALCHEMY_MONITOREO_URL)

SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)
Base = declarative_base

with monitoreo.connect() as connection2:

    query = """ SELECT ID_MUESTREO, ID_PROYECTO
                FROM VM_DATOS_MONITOREO
                WHERE id_muestreo in (12140,12141,12142,12143,12144,12145,12146,12147,19681,19682,19683,19687,19693,19694,19752,350514268851590351,
                350514744619290581,350514744631509911,350514744633832571,350514744636127411,350514744638814671,350514744639957221,350514744640744931,
                350514744641603541,350514744642469471,350514744643101901,350514744646894001,350514744647557861,350514744648129961,350514744648958391,
                350514744651166011,350514744656828681,350514744658036711,350514744659322721,350514744660984001,350514744665644491,350514744666258231,
                350514744667728771,350514744668207221,350514744668945601,350514744670292481,350514744680045321,350514744681071191,350514744712450331,
                350514744715772371,350514744717626691,350514744718421491,350514744721746611,350514744732779061,350514744737936451,350514744739355881,
                350514744741022391,350514744741580821,350514744743909311,350514744748047951,350514744748516091,350514744749229411,350514744821502401,
                350514744825601031,350514744848155081,350514744849376391,350514744849926141,350514744861267331,350514744863884681,350514744867098731,
                350514744868778091,350514744871164511,350514744872278161,350514744877043391,350514744878564571,350514744879837431,350514744881579631,
                350514744884247751,350514744885886891,350514744887035741,350514744889541191,350514746378202081,350514746379726461,350514746380495051,
                350514746381156661,350514746382251601,350514746383746571,350514746384306971,350514746384886001,350514746385242911,350514746385979091,
                350514746386364931,350514746386697311,350514746387032031,350514746387368971,350514746387698141,350514746388104011,350514746388519451,
                350514746389107181,350514746389635371,350514746390092851,350514746390384611,350514746390811211,350514746391302371,350514746393026801,
                350514746393495231,350514746393841931,350514746394291401,350514746394555611,350514746394951991,350514746396012161,
                350514746396989781,350514746397347051,350514746397647921,350514746398004531,350514746398722421,350514746399177361,350514746408414001,
                350514746409012051,350514746409555731,350514746409947211,350514746410751761,350514746411192601,350514746411709731,350514746412048351,
                350514746412332141,350514746412615581,350514746412938841,350514746413232351,350514746413694361,350514746414208181,350514746414584431,
                350514746415007571,350514746415438821,350514746415826721,350514746416346661,350514746416749521,350514746417177061,350514746417547291,
                350514746417874231,350514746418299271,350514746418661431,350514746419142201,350514746419593791,350514746419926611,350514746420258961,
                350514746420747691,350514746421018331,350514746421436741,350514746421921271,350514746422278601,350514746422600741,350514746422961141,
                350514746423284801,350514746423574301,350514746423923451,350514746424370381,350514746424640911,350514746424945381,350514746425225381,
                350514746425438711,350514746425767131,350514746426113191,350514746426517071,350514746426889941,350514746427264771,350514746427635481,
                350514746428005511,350514746428378261,350514746428824141,350514746429135351,350514746429493991,350514746429765191,350514746430134901,
                350514746430720701,350514746431011941,350514746431311981,350514746431604941,350514746431912571,350514746432188751,350514746432554231,
                350514746437751321,350514746438279501,350514746438714511,350514746442977851,350514746443393561,350514746443843281,350514746444387881,
                350514746444788981,350514746445456001,350514746445881841,350514746446200291,350514746446631191,350514746446972701,350514746447497361,
                350514746447886841,350514746448200251,350514746448555631,350514746448859181,350514746449269341,350514746449646931,350514746450004631,
                350514746450337591,350514746450754171,350514746451076071,350514746451741911,350514746452114391,350514746452650911,350514746453061051,350514746453482441,350514746454184441,
                350514746454563041,350514746455186121,350514746455603731,350514746456003581,350514746456433991,350514746456917881,350514746457212831,
                350514746457761621,350514746458048441,350514746458475251,350514746458941741,350514746459988021,350514746461018241,350514746461293551,
                350514746461643281,350514746462138551,350514746462674351,350514746463036761,350514746463496991,350514746463903171,350514746464223181,
                350514746464635981,350514746465067471,350514746465345421,350514746465858811,350514746466402091,350514746466784811,350514746467064291,
                350514746467353871,350514746467686551,350514746467938451,350514746468439811,350514746468751901,350514746469064411,350514746469376511,
                350514746469789321,350514746470083341,350514746470379761,350514746470691501,350514746470917241,350514746471146591,350514746471475271,
                350514746471838641,350514746472127611,350514746472387471,350514746472693271,350514746472993841,350514746473221841,350514746473595811,
                350514746473853651,350514746474129371,350514746474479551,350514746475059171,350514746475328641,350514746475688521,350514746475948561,
                350514746476237011,350514746476592491,350514746476927261,350514746552377391,350514746554381001,350514746554926951,350514746555676401,
                350514746556116801,350514746556662291,350514746557137661,350514746557920351,350514746558377361,350514746559112401,350514746559510441,
                350514746559974241,350514746560703231,350514746561190901,350514746561843381,350514746563026571,350514746563601661,350514746564567891,
                350514746565103581,350514746565615421,350514746566861541,350514746568433021,350514746568983791,350514746569346461,350514746569873271,
                350514746570554531,350514746571069221,350514746571514591,350514746571884661,350514746572369581,350514746572902181,350514746573341461,
                350514746574289431,350514746575347571,350514746581189191,350514746581590111,350514746582977871,350514746583619841,350514746584040811,350514746584571251,350514746585029151,
                350514746585785861,350514746586255501,350514746586598781,350514746587185961,350514746587713631,350514746588699591,350514746589248271,
                350514746589924281,350514746590604021,350514746591275291,350514746591712871,350514746592131821,350514746593050221,350514746593486501,
                350514746594026361,350514746594444951,350514746594776181,350514746595199121,350514746602507491,350514746603143201,350514746603880301,
                350514746604309821,350514746604609911,350514746605534141,350514746606144481,350514746606793681,350514746607381741,350514746607948131,
                350514746608560381,350514746609034641,350514746609487941,350514746610132661,350514746610493301,350514746610783711,350514746611152921,
                350514746611539411,350514746612076651,350514746612465121,350514746612908441,350514746613267121,350514746613601611,350514746614158211,
                350514746614576031,350514746614887721,350514746615380301,350514746616191401,350514746616590241,350514746617066781,350514746617763171,
                350514746618344521,350514746618748281,350514746619171851,350514746619719661,350514746620178711,350514746620639231,350514746621009041,
                350514746621401711,350514746621724511,350514746622160441,350514746622419311,350514746622693981,350514746623047901,350514746623433181,
                350514746623765411,350514746624082511,350514746624430821,350514746627342251,350514746627737021,350514746628223261,350514746628552901,
                350514746629054411,350514746630072411,350514746630502341,350514746631380261,350514746631721031,350514746632077831,350514746632515511,
                350514746632895741,350514746633362341,350514746633620781,350514746633886181,350514746634211901,350514746634539821,350514746634898321,
                350514746635344171,350514746635679821,350514746635989271,350514746636528331,350514746636913381,350514746637336921,350514746637770691,
                350514746638055971,350514746638449231,350514746638803891,350514746639467721,350514746639791561,350514746640084761,350514746640410181,350514746641125821,350514746641965401,
                350514746642310751,350514746642740191,350514746643151051,350514746643585051,350514746644000531,350514746644442351,350514746645002211,
                350514746645576651,350514746646616911,350514746647074621,350514746647440491,350514746647938271,350514746648340221,350514746648714031,
                350514746649037031,350514746649465931,350514746649775531,350514746650201141,350514746650651881,350514746651027681,350514746651257691,
                350514746651643171,350514746651903151,350514746652135781,350514746652436791,350514746652985901,350514746653319891,350514746653538231,
                350514746653876861,350514746654126281,350514746658028331,350514746658519701,350514746659066711,350514746659373371,350514746659799281,
                350514746660095471,350514746660703961,350514746660979411,350514746661352411,350514746661616441,350514746662092401,350514746662438981,
                350514746662730551,350514746663015511,350514746663248761,350514746663532681,350514746664107761,350514746664369051,350514746664929261,
                350514746665272071,350514746665673541,350514746666100651,350514746666440341,350514746666805171,350514746667589901,350514746668129541,
                350514746668596601,350514746668863251,350514746669305791,350514746669691411,350514746670133111,350514746670512541,350514746670791701,
                350514746671294311,350514746671618981,350514746671939341,350514746672304521,350514746672678081,350514746673189081,350514746673484061,
                350514746673961921,350514746674266351,350514746674537061,350514746674856051,350514746675221611,350514746675773361,350514748923577451,
                350514748924201341,350514748924889611,350514748925483901,350514748925966441,350514748926443691,350514748927115381,350514748927561731,
                350514748927977311,350514748928556751,3220201203101317471,3220201203101330511,3220201203101339431,3220201203101351551,3220201203101407541,
                3220201203281708521,3220201203290838041,3220201203290854351,3220201203290909001,3220201203291134571,3220201203291312021,3220201203291421061,
                3220201203291429321,3220201203291454461,3220201204101315051,3220201204101335401,3220201204101346181) """

    queryResult = connection2.execute(query)
    datos = queryResult.fetchall()
    datosDf = pd.DataFrame(datos)
    datosDf.columns = [colName.upper() for colName in queryResult.keys()]

    # agd_muestreos_parametros = pd.DataFrame(columns = ['ID_MUESTREO','ID_PARAMETRO','ID_METODOLOGIA','ID_UNIDAD_MEDIDA','VALOR'])
    inserts = list()
    
    for _, df_muestreo in datosDf.groupby(['ID_MUESTREO']):
        
        insertEntidad = f"""INSERT INTO AGD_MUESTREOS_PARAMETROS (ID_MUESTREO,ID_PARAMETRO,ID_METODOLOGIA,ID_UNIDAD_MEDIDA,VALOR)   
        VALUES ({str(857)+str(df_muestreo['ID_MUESTREO'].values[0])}, {828}, {857}, {100}, '{'INVEMAR'}')"""
        
        insertProyecto = f"""INSERT INTO AGD_MUESTREOS_PARAMETROS (ID_MUESTREO,ID_PARAMETRO,ID_METODOLOGIA,ID_UNIDAD_MEDIDA,VALOR) 
        VALUES ({str(857)+str(df_muestreo['ID_MUESTREO'].values[0])},{127},{857},{100},'{df_muestreo['ID_PROYECTO'].values[0]}')"""
        

        inserts.append(insertEntidad)
        inserts.append(insertProyecto)
    
    
    inserts = pd.DataFrame(data=inserts, columns = ['SQL'])
    print(inserts)
    inserts.to_csv('muestreos_parametros.csv', index=False)
    

# with engine.connect() as connection:

#     for index, row in inserts.iterrows():
#         connection.execute(row['SQL'])
#     print('Muestreos agregados')


